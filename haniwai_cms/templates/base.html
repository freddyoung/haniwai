{% load static wagtailcore_tags wagtailuserbar %}

<!DOCTYPE html>
<html lang="en" x-data="{ 
    highContrast: false, 
    largeText: false, 
    highlightLinks: false,
    textSpacing: false,
    dyslexiaFont: false
}" :class="{ 
    'grayscale contrast-200': highContrast, 
    'text-xl': largeText,
    'tracking-widest': textSpacing,
    'font-serif': dyslexiaFont 
}">
    <head>
        <meta charset="utf-8" />
        <title>{% block title %}{% if page.seo_title %}{{ page.seo_title }}{% else %}{{ page.title }}{% endif %}{% endblock %}{% block title_suffix %} | HANIWAI{% endblock %}</title>
        <link rel="icon" type="image/png" href="{% static 'images/haniwa_logo.png' %}" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Inter:wght@200;300;400;500;600&display=swap" rel="stylesheet">
        <script src="https://cdn.tailwindcss.com"></script>
        <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
        <script src="https://unpkg.com/lucide@latest"></script>

        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            'deep-teal': 'hsl(180, 100%, 15%)',
                            'river-blue': 'hsl(180, 45%, 55%)',
                            'sky-blue': 'hsl(185, 40%, 70%)',
                            'meadow-green': 'hsl(70, 60%, 55%)',
                            'forest-green': 'hsl(140, 40%, 35%)',
                            'coral-pink': 'hsl(340, 70%, 60%)',
                            'involved-pink': '#e15b8d',
                            primary: { DEFAULT: 'hsl(180, 100%, 15%)' },
                        },
                        fontFamily: { heading: ['Poppins', 'sans-serif'], body: ['Inter', 'sans-serif'] }
                    }
                }
            }
        </script>

        <style type="text/tailwindcss">
            @layer components {
                .reveal { @apply opacity-0 translate-y-4 transition-all duration-1000 ease-out; }
                .reveal.active { @apply opacity-100 translate-y-0; }
                
                .btn-involved {
                    @apply bg-gradient-to-r from-[#e15b8d] to-[#d6417a] text-white px-8 py-3 rounded-full font-bold text-sm transition-all hover:scale-105 hover:shadow-lg active:scale-95 whitespace-nowrap;
                }

                /* Standardized Nav Link Utility */
                .nav-link {
                    @apply relative py-1 transition-colors duration-500 text-white font-bold uppercase tracking-widest text-[0.85rem] whitespace-nowrap;
                }
                .nav-link::after {
                    content: '';
                    @apply absolute bottom-0 left-0 w-0 h-0.5 transition-all duration-500 ease-in-out;
                    background-color: currentColor;
                }
                .nav-link:hover::after { @apply w-full; }
            }

            /* Navbar Layout & States */
            .nav-glass { @apply transition-all duration-700 ease-in-out bg-transparent py-5; }
            .nav-scrolled { @apply bg-white shadow-lg py-4; }

            /* Color Logic */
            .logo-text { @apply text-white transition-colors duration-700; }
            .access-trigger { @apply border-white/40 text-white transition-all duration-700; }
            
            .translate-trigger { @apply text-white transition-all duration-700 hover:bg-white/10; }
            .nav-scrolled .translate-trigger { @apply text-deep-teal hover:bg-gray-100; }
            
            .logo-img { @apply transition-all duration-700; }
            
            /* Scrolled State Overrides */
            .nav-scrolled .nav-link { @apply text-deep-teal hover:text-forest-green; }
            .nav-scrolled .logo-text { @apply text-deep-teal; }
            .nav-scrolled .access-trigger { @apply border-deep-teal/20 text-deep-teal hover:bg-gray-100; }

            .switch-ui { @apply w-10 h-5 bg-gray-300 rounded-full relative transition-colors; }
            .switch-ui-checked { @apply bg-green-500; }
            .switch-dot { @apply absolute left-1 top-1 w-3 h-3 bg-white rounded-full transition-transform; }
            .switch-dot-checked { @apply translate-x-5; }
        </style>
    </head>

    <body class="{% block body_class %}{% endblock %} font-body text-foreground bg-background">
        {% wagtailuserbar %}

        <div x-data="{ scrolled: false, accessMenu: false, mobileMenu: false }" @scroll.window="scrolled = (window.pageYOffset > 50)">
            <nav :class="scrolled ? 'nav-scrolled' : 'nav-glass'" class="fixed top-0 left-0 w-full z-50">
                <div class="w-full px-6 lg:px-12 flex items-center justify-between">
                    
                    <div class="flex-shrink-0">
                        <a href="/" class="flex items-center space-x-3">
                            <img src="{% static 'images/haniwa_logo.png' %}" alt="HANIWAI" class="h-14 w-auto logo-img">
                            <span class="logo-text font-heading font-bold text-xl tracking-tighter">haniwai.org</span>
                        </a>
                    </div>

                    <div class="hidden lg:flex flex-grow justify-center">
                        <div class="flex items-center space-x-8">
                            <a href="{% slugurl 'about-us' %}" class="nav-link">About</a>
                            <a href="{% slugurl 'programs' %}" class="nav-link">Programs</a>
                            <a href="{% slugurl 'events' %}" class="nav-link">News</a>
                            <a href="{% slugurl 'resources' %}" class="nav-link">Resources</a>
                            <a href="{% slugurl 'faqs' %}" class="nav-link">FAQS</a>
                            <a href="{% slugurl 'contact' %}" class="nav-link">Contact</a>
                        </div>
                    </div>

                    <div class="flex items-center space-x-4 flex-shrink-0 ml-4">
                        
                        <div class="relative" x-data="{ open: false }">
                            <button @click="open = !open" 
                                    @click.away="open = false"
                                    class="translate-trigger flex items-center justify-center w-10 h-10 rounded-full"
                                    aria-label="Translate Website">
                                <i data-lucide="languages" class="w-5 h-5"></i>
                            </button>

                            <div x-show="open" 
                                x-cloak
                                x-transition:enter="transition ease-out duration-200"
                                x-transition:enter-start="opacity-0 scale-95"
                                x-transition:enter-end="opacity-100 scale-100"
                                class="absolute right-0 mt-2 w-56 bg-white border border-gray-100 rounded-2xl shadow-xl z-50 py-2 grid grid-cols-1 gap-1">
                                
                                <button @click="changeLanguage('en'); open = false" class="text-left px-4 py-2 text-sm text-gray-700 hover:bg-[#004d4d] hover:text-white transition-colors">English</button>
                                <button @click="changeLanguage('tpi'); open = false" class="text-left px-4 py-2 text-sm text-gray-700 hover:bg-[#004d4d] hover:text-white transition-colors font-bold italic">Tok Pisin (PNG)</button>
                                <button @click="changeLanguage('zh-CN'); open = false" class="text-left px-4 py-2 text-sm text-gray-700 hover:bg-[#004d4d] hover:text-white transition-colors">Chinese (Mandarin)</button>
                                <button @click="changeLanguage('es'); open = false" class="text-left px-4 py-2 text-sm text-gray-700 hover:bg-[#004d4d] hover:text-white transition-colors">Spanish</button>
                                <button @click="changeLanguage('fr'); open = false" class="text-left px-4 py-2 text-sm text-gray-700 hover:bg-[#004d4d] hover:text-white transition-colors">French</button>
                                <button @click="changeLanguage('de'); open = false" class="text-left px-4 py-2 text-sm text-gray-700 hover:bg-[#004d4d] hover:text-white transition-colors">German</button>
                                <button @click="changeLanguage('pt'); open = false" class="text-left px-4 py-2 text-sm text-gray-700 hover:bg-[#004d4d] hover:text-white transition-colors">Portuguese</button>
                                <button @click="changeLanguage('ru'); open = false" class="text-left px-4 py-2 text-sm text-gray-700 hover:bg-[#004d4d] hover:text-white transition-colors">Russian</button>
                                <button @click="changeLanguage('ar'); open = false" class="text-left px-4 py-2 text-sm text-gray-700 hover:bg-[#004d4d] hover:text-white transition-colors text-right">العربية</button>
                                <button @click="changeLanguage('ja'); open = false" class="text-left px-4 py-2 text-sm text-gray-700 hover:bg-[#004d4d] hover:text-white transition-colors">日本語</button>
                                <button @click="changeLanguage('ko'); open = false" class="text-left px-4 py-2 text-sm text-gray-700 hover:bg-[#004d4d] hover:text-white transition-colors">한국어</button>
                                
                                <div id="google_translate_element" class="absolute opacity-0 w-0 h-0 overflow-hidden"></div>
                            </div>
                        </div>

                        <a href="{% slugurl 'donate' %}" class="hidden sm:inline-block btn-involved">Donate</a>

                        <div class="relative">
                            <button @click="accessMenu = !accessMenu" 
                                    class="access-trigger w-11 h-11 rounded-full border-2 flex items-center justify-center hover:scale-105 active:scale-95">
                                <i data-lucide="accessibility" class="w-6 h-6"></i>
                            </button>

                            <div x-show="accessMenu" @click.away="accessMenu = false" x-transition 
                                 class="absolute right-0 mt-4 w-72 bg-white rounded-2xl shadow-2xl p-5 text-gray-800 z-[60] border border-gray-100">
                                <h3 class="font-bold text-lg mb-4 text-[#004d4d]">Accessibility</h3>
                                <div class="space-y-4">
                                    <template x-for="(label, key) in { highContrast: 'High Contrast', largeText: 'Large Text', highlightLinks: 'Highlight Links', textSpacing: 'Increase Spacing', dyslexiaFont: 'Dyslexia Font' }">
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-medium text-[#004d4d]" x-text="label"></span>
                                            <div @click="$data[key] = !$data[key]" class="switch-ui cursor-pointer" :class="$data[key] ? 'switch-ui-checked' : ''">
                                                <div class="switch-dot" :class="$data[key] ? 'switch-dot-checked' : ''"></div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>

                        <button @click="mobileMenu = !mobileMenu" class="lg:hidden text-current p-2">
                            <i data-lucide="menu" class="w-8 h-8" :class="scrolled ? 'text-deep-teal' : 'text-white'"></i>
                        </button>
                    </div>
                </div>

                <div x-show="mobileMenu" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-x-full" x-transition:enter-end="opacity-100 translate-x-0" x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100 translate-x-0" x-transition:leave-end="opacity-0 translate-x-full" class="fixed inset-0 bg-deep-teal z-[70] flex flex-col p-8 lg:hidden">
                    <div class="flex justify-between items-center mb-12">
                        <span class="font-heading font-bold text-2xl text-white">Menu</span>
                        <button @click="mobileMenu = false" class="text-white"><i data-lucide="x" class="w-8 h-8"></i></button>
                    </div>
                    <div class="flex flex-col space-y-6 text-2xl font-heading font-semibold text-white">
                        <a href="{% slugurl 'about-us' %}" @click="mobileMenu = false">About</a>
                        <a href="{% slugurl 'programs' %}" @click="mobileMenu = false">Programs</a>
                        <a href="{% slugurl 'news-events' %}" @click="mobileMenu = false">News</a>
                        <a href="{% slugurl 'resources' %}" @click="mobileMenu = false">Resources</a>
                        <a href="{% slugurl 'faqs' %}" @click="mobileMenu = false">FAQS</a>
                        <a href="{% slugurl 'contact' %}" @click="mobileMenu = false">Contact</a>
                        <a href="{% slugurl 'donate' %}" class="pt-6 text-involved-pink" @click="mobileMenu = false">Donate Now</a>
                    </div>
                </div>
            </nav>
        </div>

        <main>{% block content %}{% endblock %}</main>

        <footer class="bg-white border-t border-gray-100 font-body relative overflow-hidden" x-data="{ subscribed: false, email: '' }">
            <div class="absolute inset-0 z-0 pointer-events-none opacity-[0.03]" 
                style="background: radial-gradient(circle at 100% 50%, #000 0%, transparent 60%);">
            </div>

            <div class="relative pt-16 pb-12">
                <div class="container mx-auto px-4 max-w-7xl relative z-10">
                    <div class="grid grid-cols-1 md:grid-cols-12 gap-12 items-start">
                        
                        <div class="md:col-span-4 space-y-8">
                            <div class="space-y-6">
                                <div class="flex items-center space-x-3">
                                    <img src="{% static 'images/haniwa_logo.png' %}" alt="HANIWAI" class="h-12 w-auto">
                                    <span class="font-heading font-bold text-2xl tracking-tighter text-[#004d4d]">haniwai.org</span>
                                </div>
                                <p class="text-gray-600 text-base leading-relaxed">
                                    Empowering indigenous women and protecting the biodiversity of Papua New Guinea through grassroots advocacy.
                                </p>
                                <div class="flex space-x-5">
                                    <a href="#" class="text-[#004d4d] hover:text-[#4da6a6] transition-colors"><i data-lucide="facebook" class="w-5 h-5"></i></a>
                                    <a href="#" class="text-[#004d4d] hover:text-[#4da6a6] transition-colors"><i data-lucide="instagram" class="w-5 h-5"></i></a>
                                    <a href="#" class="text-[#004d4d] hover:text-[#4da6a6] transition-colors"><i data-lucide="linkedin" class="w-5 h-5"></i></a>
                                </div>
                            </div>

                            <div class="pt-4 border-t border-gray-50 max-w-sm">
                                <h5 class="font-heading font-bold text-[#004d4d] uppercase tracking-widest text-[10px] mb-4">Join our Newsletter</h5>
                                <div x-show="!subscribed">
                                    <form @submit.prevent="subscribed = true" class="relative group">
                                        <input type="email" x-model="email" placeholder="Email Address" required
                                            class="w-full bg-gray-50 border-b-2 border-gray-200 py-3 px-1 text-sm focus:outline-none focus:border-[#004d4d] transition-all duration-300 placeholder:text-gray-400">
                                        <button type="submit" class="absolute right-0 top-1/2 -translate-y-1/2 text-[#004d4d] hover:text-[#4da6a6] p-2 transition-transform group-hover:translate-x-1">
                                            <i data-lucide="arrow-right" class="w-5 h-5"></i>
                                        </button>
                                    </form>
                                </div>
                                <div x-show="subscribed" x-cloak class="flex items-center space-x-2 text-[#004d4d] py-3 text-sm font-medium animate-pulse">
                                    <i data-lucide="check-circle" class="w-4 h-4"></i>
                                    <span>Thank you for subscribing!</span>
                                </div>
                            </div>
                        </div>

                        <div class="md:col-span-3 lg:col-span-2 lg:ml-auto">
                            <h4 class="font-heading font-bold text-[#004d4d] uppercase tracking-[0.2em] text-xs mb-6">Organization</h4>
                            <ul class="space-y-4 text-base font-medium">
                                <li><a href="{% slugurl 'about-us' %}" class="text-gray-600 hover:text-[#004d4d] transition-colors">About Us</a></li>
                                <li><a href="{% slugurl 'programs' %}" class="text-gray-600 hover:text-[#004d4d] transition-colors">Our Programs</a></li>
                                <li><a href="{% slugurl 'events' %}" class="text-gray-600 hover:text-[#004d4d] transition-colors">News & Events</a></li>
                                <li><a href="{% slugurl 'faqs' %}" class="text-gray-600 hover:text-[#004d4d] transition-colors">FAQs</a></li>
                            </ul>
                        </div>

                        <div class="md:col-span-2 lg:col-span-2">
                            <h4 class="font-heading font-bold text-[#004d4d] uppercase tracking-[0.2em] text-xs mb-6">Support</h4>
                            <ul class="space-y-4 text-base font-medium">
                                <li><a href="{% slugurl 'donate' %}" class="text-gray-600 hover:text-[#004d4d] transition-colors">Donate Now</a></li>
                                <li><a href="{% slugurl 'contact' %}" class="text-gray-600 hover:text-[#004d4d] transition-colors">Contact</a></li>
                            </ul>
                        </div>

                        <div class="md:col-span-3 lg:col-span-4 flex justify-end">
                            <div class="relative w-full max-w-[280px] aspect-[4/5] overflow-hidden">
                                <img src="{% static 'images/footer.png' %}" 
                                    alt="HANIWAI Community" 
                                    class="w-full h-full object-cover grayscale hover:grayscale-0 transition-all duration-700">
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="bg-white border-t border-gray-100 py-8 relative z-20">
                <div class="container mx-auto px-4 max-w-7xl">
                    <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
                        <div class="flex space-x-6 text-[11px] uppercase tracking-[0.2em] text-gray-400 font-bold">
                            <p>&copy; 2026 HANIWAI ASSOCIATION</p>
                            <a href="/privacy-policy/" class="hover:text-[#004d4d] transition-colors">Privacy</a>
                            <a href="/terms/" class="hover:text-[#004d4d] transition-colors">Terms</a>
                        </div>
                        
                        <div class="flex items-center space-x-2 text-[11px] uppercase tracking-[0.2em] text-gray-400 font-bold">
                            <span>SITE POWERED BY</span>
                            <a href="https://www.niuera.com.pg" target="_blank" class="text-[#004d4d] hover:text-[#4da6a6] transition-all flex items-center group">
                                <span class="border-b border-transparent group-hover:border-[#4da6a6]">NIUERA</span>
                                <i data-lucide="external-link" class="w-3.5 h-3.5 ml-1.5 opacity-50"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </footer>

        <script>
            lucide.createIcons();
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('active'); });
            }, { threshold: 0.1 });
            document.addEventListener('DOMContentLoaded', () => {
                document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
            });
        </script>

        <script type="text/javascript">
            function googleTranslateElementInit() {
                new google.translate.TranslateElement({
                    pageLanguage: 'en',
                    includedLanguages: 'en,tpi,zh-CN,es,fr,de,pt,ru,ar,ja,ko',
                    layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
                    autoDisplay: false
                }, 'google_translate_element');
            }

            function changeLanguage(langCode) {
                const select = document.querySelector('.goog-te-combo');
                if (select) {
                    select.value = langCode;
                    select.dispatchEvent(new Event('change'));
                    select.dispatchEvent(new Event('input'));
                } else {
                    const domain = window.location.hostname;
                    document.cookie = `googtrans=/auto/${langCode}; domain=${domain}; path=/`;
                    document.cookie = `googtrans=/auto/${langCode}; domain=.${domain}; path=/`;
                    location.reload();
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                const observer = new MutationObserver(function(mutations) {
                    if (document.body.style.top !== '0px') document.body.style.setProperty('top', '0px', 'important');
                    if (document.documentElement.style.top !== '0px') document.documentElement.style.setProperty('top', '0px', 'important');
                    if (document.documentElement.style.marginTop !== '0px') document.documentElement.style.setProperty('margin-top', '0px', 'important');
                    const bannerFrame = document.querySelector('.goog-te-banner-frame');
                    if (bannerFrame) bannerFrame.style.setProperty('display', 'none', 'important');
                });
                observer.observe(document.documentElement, { attributes: true, attributeFilter: ['style'], childList: true, subtree: true });
            });
        </script>
        <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

        <style>
            html, body {
                top: 0 !important; 
                position: static !important; 
                margin-top: 0 !important;
                height: 100% !important;
                min-height: 100%;
            }
            .goog-te-banner-frame.skiptranslate, iframe.goog-te-banner-frame, .goog-te-gadget-simple, #goog-gt-tt {
                display: none !important;
                visibility: hidden !important;
                width: 0 !important;
                height: 0 !important;
            }
            .goog-tooltip, .goog-tooltip:hover { display: none !important; }
            .goog-text-highlight { background-color: transparent !important; border: none !important; box-shadow: none !important; }
        </style>
    </body>
</html>