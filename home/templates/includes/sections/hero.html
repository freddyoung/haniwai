{% load static wagtailcore_tags wagtailimages_tags %}

<style>
    [x-cloak] { display: none !important; }

    /* Core HANIWAI Glassmorphism for Cards */
    .glass-pane {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.15);
    }

    .peel-shade-top {
        background: radial-gradient(circle at 0% 0%, rgba(0,0,0,0.3) 0%, transparent 50%);
        pointer-events: none;
    }

    /* Mobile First Visibility Logic */
    .hollow-text {
        color: white;
        -webkit-text-stroke: 0px;
        text-shadow: 0 0 20px rgba(255,255,255,0.4);
        transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
    }

    .card-title-move {
        transform: translateY(-2.2rem);
        transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
    }

    .content-reveal {
        position: absolute;
        bottom: 15%;
        width: 100%;
        opacity: 1;
        transform: translateY(0);
        transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
    }

    /* Desktop Hover Interactions (md: 768px+) */
    @media (min-width: 768px) {
        .hollow-text {
            color: transparent;
            -webkit-text-stroke: 1px rgba(255, 255, 255, 0.8);
            text-shadow: none;
        }
        .group:hover .hollow-text {
            color: white;
            -webkit-text-stroke: 0px;
            text-shadow: 0 0 20px rgba(255,255,255,0.4);
        }

        .card-title-move {
            transform: translateY(0);
        }
        .group:hover .card-title-move {
            transform: translateY(-2.2rem);
        }

        .content-reveal {
            opacity: 0;
            transform: translateY(1.5rem);
        }
        .group:hover .content-reveal {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .icon-aura {
        background: radial-gradient(circle, rgba(255,255,255,0.08) 0%, transparent 70%);
        filter: blur(60px);
    }
</style>

<div x-data="{ 
    isModalOpen: false,
    imageError: false, 
    selectedMission: { title: '', description: '', gradient: '', iconImg: '' },
    
    openModal(mission) {
        this.selectedMission = mission;
        this.imageError = false; 
        this.isModalOpen = true;
        document.body.style.overflow = 'hidden'; 
    },
    
    closeModal() {
        this.isModalOpen = false;
        document.body.style.overflow = ''; 
    }
}" class="relative z-30">

    <section class="relative min-h-[80vh] flex flex-col justify-center bg-primary z-10 pb-0">
        <div id="hero-parallax" class="absolute inset-0 w-full h-full z-0 pointer-events-none">
            {% if page.hero_background_image %}
                {% image page.hero_background_image fill-1920x1080 as bg_img %}
                <img src="{{ bg_img.url }}" class="w-full h-full object-cover" alt="Hero Background">
            {% else %}
                <img src="{% static 'images/traditional-bilas.webp' %}" class="w-full h-full object-cover" alt="HANIWAI">
            {% endif %}
            <div class="absolute inset-0 bg-primary/50 mix-blend-multiply"></div>
            <div class="absolute inset-0 bg-gradient-to-b from-primary/80 via-transparent to-primary"></div>
        </div>

        <div class="relative z-20 container mx-auto px-4 text-center pt-32 pb-16 md:pb-24">
            <h1 class="font-sans font-extralight tracking-tight text-4xl sm:text-5xl md:text-7xl text-white mb-6 leading-tight">
                Humanity and Nature<br />
                <span class="font-semibold block mt-2">Indigenous Women's Association</span>
            </h1>
            <p class="text-lg md:text-xl text-white/90 max-w-2xl mx-auto font-light tracking-wide">
                Empowering indigenous women and communities in Papua New Guinea
            </p>
        </div>

        <div class="container mx-auto px-4 relative z-30 -mb-24 md:-mb-32">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 lg:gap-8 max-w-7xl mx-auto items-end">
                
                <button class="group relative w-full aspect-[1.5/1] rounded-2xl overflow-hidden transition-all duration-500 hover:-translate-y-4 hover:shadow-2xl"
                    @click="openModal({
                        title: 'PRESERVE',
                        description: 'We work to preserve the rich cultural heritage and traditions of indigenous communities, ensuring they are passed down to future generations.',
                        gradient: 'from-emerald-500/40 to-teal-600/40',
                        iconImg: '{% static 'images/preserve.png' %}'
                    })">
                    <div class="absolute inset-0 bg-gradient-to-br from-emerald-500 via-teal-600 to-cyan-700 opacity-40"></div>
                    <div class="absolute inset-0 glass-pane"></div>
                    <div class="peel-shade-top absolute inset-0 z-10"></div>
                    <div class="relative z-40 h-full flex flex-col items-center justify-center p-6 text-center">
                        <div class="card-title-move">
                            <h2 class="hollow-text font-heading font-bold text-3xl md:text-5xl tracking-widest uppercase">PRESERVE</h2>
                        </div>
                        <div class="content-reveal px-8">
                            <div class="h-px w-16 bg-white/40 rounded-full mx-auto mb-4"></div>
                            <p class="text-white font-sans font-light text-base md:text-lg">Protecting indigenous culture and heritage</p>
                        </div>
                    </div>
                </button>

                <button class="group relative w-full aspect-[1.5/1] rounded-2xl overflow-hidden transition-all duration-500 hover:-translate-y-4 hover:shadow-2xl"
                    @click="openModal({
                        title: 'PROTECT',
                        description: 'Our mission extends to protect vulnerable, disaffected, and marginalized people groups, particularly women, alongside safeguarding our biodiversity.',
                        gradient: 'from-pink-500/40 to-purple-700/40',
                        iconImg: '{% static 'images/protect.png' %}'
                    })">
                    <div class="absolute inset-0 bg-gradient-to-br from-pink-500 via-fuchsia-600 to-purple-700 opacity-40"></div>
                    <div class="absolute inset-0 glass-pane"></div>
                    <div class="peel-shade-top absolute inset-0 z-10"></div>
                    <div class="relative z-40 h-full flex flex-col items-center justify-center p-6 text-center">
                        <div class="card-title-move">
                            <h2 class="hollow-text font-heading font-bold text-3xl md:text-4xl lg:text-5xl tracking-widest uppercase">PROTECT</h2>
                        </div>
                        <div class="content-reveal px-8">
                            <div class="h-px w-16 bg-white/40 rounded-full mx-auto mb-4"></div>
                            <p class="text-white font-sans font-light text-base md:text-lg">Safeguarding our environment and people</p>
                        </div>
                    </div>
                </button>

                <button class="group relative w-full aspect-[1.5/1] rounded-2xl overflow-hidden transition-all duration-500 hover:-translate-y-4 hover:shadow-2xl"
                    @click="openModal({
                        title: 'TRANSFORM',
                        description: 'We aim to transform lives by empowering women and providing education, creating a foundation for a sustainable future.',
                        gradient: 'from-orange-500/40 to-yellow-600/40',
                        iconImg: '{% static 'images/transform.png' %}'
                    })">
                    <div class="absolute inset-0 bg-gradient-to-br from-orange-500 via-amber-600 to-yellow-600 opacity-40"></div>
                    <div class="absolute inset-0 glass-pane"></div>
                    <div class="peel-shade-top absolute inset-0 z-10"></div>
                    <div class="relative z-40 h-full flex flex-col items-center justify-center p-6 text-center">
                        <div class="card-title-move">
                            <h2 class="hollow-text font-heading font-bold text-3xl md:text-4xl lg:text-5xl tracking-widest uppercase">TRANSFORM</h2>
                        </div>
                        <div class="content-reveal px-8">
                            <div class="h-px w-16 bg-white/40 rounded-full mx-auto mb-4"></div>
                            <p class="text-white font-sans font-light text-base md:text-lg">Empowering communities for the future</p>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </section>

    {# --- IMMERSIVE OVERLAY (No Box) --- #}
    <div x-cloak x-show="isModalOpen" class="fixed inset-0 z-50 flex items-center justify-center p-6" role="dialog">
        
        {# Deep Glassmorphic Backdrop #}
        <div class="absolute inset-0 bg-slate-950/80 backdrop-blur-[45px]" 
             x-show="isModalOpen" 
             x-transition:enter="transition-opacity duration-700" 
             x-transition:leave="transition-opacity duration-500"
             @click="closeModal()"></div>

        {# Content Wrapper: Now transparent and free-floating #}
        <div class="relative w-full max-w-4xl flex flex-col items-center justify-center text-center py-12"
             x-show="isModalOpen" 
             x-transition:enter="transition ease-out duration-700 transform" x-transition:enter-start="opacity-0 translate-y-12 scale-95" 
             x-transition:enter-end="opacity-100 translate-y-0 scale-100"
             x-transition:leave="transition ease-in duration-400 transform" x-transition:leave-start="opacity-100 translate-y-0 scale-100" 
             x-transition:leave-end="opacity-0 translate-y-12 scale-95">
            
            {# Icons restored to original color #}
            <div class="relative mb-10 md:mb-14">
                <div class="absolute inset-0 icon-aura scale-150"></div>
                <img :src="selectedMission.iconImg" 
                     class="relative z-10 w-44 h-44 md:w-60 md:h-60 object-contain" 
                     x-show="!imageError" @error="imageError = true">
            </div>

            <h3 class="text-4xl md:text-6xl font-medium font-heading mb-6 text-white drop-shadow-lg tracking-wider" x-text="selectedMission.title"></h3>
            
            {# Refined Solid Separator #}
            <div class="h-[1px] w-24 bg-white/20 mb-10 md:mb-12"></div>
            
            <p class="max-w-3xl text-xl md:text-2xl text-white/90 leading-relaxed font-light drop-shadow-md mb-16 md:mb-20" x-text="selectedMission.description"></p>

            <button @click="closeModal()" 
                    class="px-14 py-4 text-white/60 hover:text-white border border-white/20 rounded-full text-xs md:text-sm uppercase tracking-[0.4em] transition-all hover:bg-white/10 glass-pane">
                Close
            </button>
        </div>
    </div>
</div>